DROP TABLE LibraryUser;
CREATE TABLE LibraryUser(
        UserID                      CHAR(7)                     NOT NULL,
        UserName                    VARCHAR2(50)                NOT NULL,
        UserEmail                   VARCHAR2(50)                NOT NULL,
        UserPhoneNo                 VARCHAR2(11)                NOT NULL,
        UserPassword                VARCHAR2(20)                NOT NULL,
        UserGender                  CHAR(1)                     NOT NULL,
        UserDateOfBirth             DATE                        NOT NULL,
        UserNationality             VARCHAR2(13)                NOT NULL,        
        UserRegistrationDate        DATE                            DEFAULT SYSDATE         NOT NULL,
        UserLastLoginDate           DATE,
        UserAccountStatus           VARCHAR2(11)                DEFAULT 'ACTIVE'            NOT NULL,
        MembershipType              VARCHAR2(8)                 DEFAULT 'NONE'          NOT NULL,
        MembershipExpiry            DATE,
        MaxBookAllowed              NUMBER(2,0)                        DEFAULT 2                  NOT NULL,
        MembershipStatus            VARCHAR2(9),
        constraint pk_userID PRIMARY KEY(UserID),
        constraint check_u_userID CHECK (REGEXP_LIKE(UserID, '^US([0-9]{5})+$')),
        constraint check_u_useremail CHECK (REGEXP_LIKE(UserEmail,'^[a-zA-Z0-9._%+-]+@[a-zA-Z]+\.(com)$')),
        constraint check_u_userphone CHECK (REGEXP_LIKE(UserPhoneNo, '^01([0-9]{8,9})+$')),
        constraint check_u_userPassword CHECK (REGEXP_LIKE(UserPassword, '[A-Z]') AND REGEXP_LIKE(UserPassword, '[a-z]') AND REGEXP_LIKE(UserPassword, '\d') AND REGEXP_LIKE(UserPassword, '[^A-Za-z0-9]') AND LENGTH(UserPassword) BETWEEN 8 AND 20 ),
        constraint check_u_userGender CHECK (UserGender IN ('M', 'F')),
        constraint check_u_userNationality CHECK (UserNationality IN ('MALAYSIAN','NON-MALAYSIAN')),
        constraint check_u_userLastLogin CHECK (UserLastLoginDate IS NULL OR UserLastLoginDate >= UserRegistrationDate),
        constraint check_u_userAccStatus CHECK (UserAccountStatus IN ('ACTIVE', 'INACTIVE','TERMINATED','BLACKLISTED')),
        constraint check_u_memType CHECK (MembershipType IN ('NONE','BASIC','STANDARD','PREMIUM')),
        constraint check_u_maxBookAllowed CHECK ((MaxBookAllowed = 2 AND (MembershipType = 'NONE'))OR(MaxBookAllowed = 3 AND (MembershipType = 'BASIC')) OR(MaxBookAllowed = 6 AND (MembershipType = 'STANDARD')) OR (MaxBookAllowed = 10 AND (MembershipType = 'PREMIUM'))),
        constraint check_u_memExpiry CHECK ((MembershipExpiry IS NULL AND (MembershipType = 'NONE'))OR(MembershipExpiry IS NOT NULL AND (MembershipType IN ('BASIC','STANDARD','PREMIUM')))),
        constraint check_u_memStatus CHECK (((MembershipStatus IN ('ACTIVE','EXPIRED'))AND(MembershipType IN ('BASIC','STANDARD','PREMIUM')))OR(MembershipStatus IS NULL AND MembershipType='NONE'))
);
